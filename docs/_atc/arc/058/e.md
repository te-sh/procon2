---
title: "ARC #058 C"
problem: https://beta.atcoder.jp/contests/arc058/tasks/arc058_c
---
桁 DP を使って条件に合わない数列の数を数える.

$$ i $$ 桁目まで見たときに $$ i $$ 桁目を最後として条件に合うかどうか調べるためには直前 $$ k = X+Y+Z-1 $$ 個の要素を持っておけばいい.

$$ i $$ 桁目まで見たときの直前16個の要素が $$ S_i = \{ x_{i-k}, x_{i-k+1}, \dots, x_{i-1} \} $$ である組み合わせの数を $$ C(i, S) $$ とする. $$ i $$ 桁目の数値が $$ x_i $$ とすると, $$ S_i + x_i $$ で条件を満たすかどうかを調べ, 満たさないなら

$$
C(i, S_i) += C(i-1, S_{i-1})
$$

という感じで DP を更新していくイメージである.

しかし, このままでは状態数が $$ N \times 10^k $$ となって間に合わない.

ここで, 持っておくべき直前の数値は累積和が $$ k $$ までであることを利用する. 数値を $$ 1 $$ を `1`, $$ 2 $$ を `10`, $$ 3 $$ を `100` という感じで表してみる. そうすると $$ \{ 1, 2, 3 \} $$ は `110100` となる. そうすると文字数が累積和を表すことになり, 文字数は $$ k $$ 文字しか持たなくてもよくなる. また, 条件を満たすかどうかは下から $$ Z, Z+Y, Z+Y+X $$ ビット目が立っているかどうかで判断できるようになる.

こうすれば状態数は $$ N \times 2^k $$ となり, 十分に間に合う.
