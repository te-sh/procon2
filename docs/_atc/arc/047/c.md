---
title: "ARC #047 C"
problem: https://atcoder.jp/contests/arc047/tasks/arc047_c
---
階乗進数を使う.

まずは階乗進数で $$ N!/K $$ を表す.

$$ N $$ 桁目は $$ N!/K(N-1)! $$ の商なので, これは $$ c_N = \lfloor N/K \rfloor $$ となる. 余りは $$ N!/K-c_N(N-1)! = (N/K-c_N)(N-1)! $$ となる. $$ N/K-c_N = (N-Kc_N)/K $$ となり, $$ N-Kc_N $$ は $$ N $$ を $$ K $$ で割った余りなので, これを $$ m_N $$ とおくと $$ m_N(N-1)!/K $$ となる.

$$ N-1 $$ 桁目は $$ m_N(N-1)!/K(N-2)! $$ の商なので, これは $$ c_{N-1} = \lfloor m_N(N-1)/K \rfloor $$ となる. 余りは同様に $$ m_{N-1}(N-2)!/K $$ となる.

以下これを繰り返して階乗進数での値を得る.

実際には $$ N!/K $$ 番目はこの階乗進数のひとつ前で表されるので, 1を引く.

階乗進数での値が分かれば順列に変換すればいい. 順列への変換は Fenwick Tree を使って二分探索で行う.
