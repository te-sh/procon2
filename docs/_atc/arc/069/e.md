---
title: "ARC #069 E"
problem: https://atcoder.jp/contests/arc069/tasks/arc069_c
---
ある時点で最も石が多い山が $$ x $$ だとすると, $$ x $$ より番号が小さい山で $$ x $$ の次に石の数が多い山を $$ y $$ とすると, $$ y $$ と石の数が同じになるように $$ x $$ 以降の石を減らしていく方法が最適である. このとき, 数列には $$ \sum_i (a_i - a_y) $$ 個の $$ x $$ が出現する. ただし, $$ i $$ は $$ x $$ 以降で $$ a_y $$ より多い数の石を持つ山である.

これを効率的に計算するために, 以下の操作をする.

* まずは $$ x $$ を求める. そして $$ x $$ 以降で $$ a_i = a_x $$ となる山の個数(最大山数とする)を数えておく. また, $$ a_i \lt a_x $$ となる数値は赤黒木に突っ込む.
* 次に $$ y $$ を求める. $$ y $$ はセグメント木を構築しておけば求めやすいだろう.
* $$ \sum_i (a_i - a_y) $$ を求める. これは最大山数と赤黒木を探索すれば計算できる. ここで操作した山はすべて $$ a_y $$ となるので, 赤黒木から削除して最大山数を増やす.
* $$ y $$ 以降 $$ x $$ までの山の数値は赤黒木に突っ込み, $$ y $$ を新たな $$ x $$ として以下これを繰り返す.

