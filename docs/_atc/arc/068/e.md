---
title: "ARC #068 E"
problem: https://beta.atcoder.jp/contests/arc068/tasks/arc068_c
---
特産品 $$ i $$ を売っている区間の幅を $$ w_i = r_i-l_i+1 $$ とする.

$$ d $$ を固定すると, $$ w_i \geq d $$ である区間は必ず1回以上訪れることになり, $$ w_i \lt d $$ である区間は高々1回しか訪れない.

そこで, 区間を $$ w_i $$ でグループ分けしておく. $$ w_i \geq d $$ となる区間の数は簡単に求められる. $$ w_i \lt d $$ となる区間は Fenwick Tree にその区間を +1 したものを用意する. どの区間も高々1回しか訪れないので, この Fenwick Tree の $$ d, 2d, 3d, \dots $$ の総和を求めることで訪れる区間の数を求めることができる.

$$ d $$ を増やしていくと $$ w_i \lt d $$ となる区間が増えていくので, その度に Fenwick Tree を更新していく.

ただし, Fenwick Tree で区間更新をすると遅くなるので, imos 法を応用して $$ l_i $$ を $$ +1 $$, $$ r_i+1 $$ を $$ -1 $$ する更新を行い, $$ d $$ の値は $$ [0, d] $$ の総和を取るようにする.
