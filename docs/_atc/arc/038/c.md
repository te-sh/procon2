---
title: "ARC #038 C"
problem: https://atcoder.jp/contests/arc038/tasks/arc038_c
---
豆が1つの場合, 豆がどんどん番号の小さい茶碗に移っていって茶碗0にたどり着いたときの手番の人が負けである. ということで grundy 数の計算に帰着できる.

複数の豆の場合もすべて grundy 数を求めて XOR を取ればいい. 同じ茶碗の豆の grundy 数は XOR は2回取ったら消えるので $$ A_i $$ は偶奇のみ分かればいい. これで100点は取れる.

しかし grundy 数を愚直に計算すると計算量は $$ O(N^2) $$ なので間に合わない.

そこで $$ g(j) = x $$ となる最大の $$ j $$ ($$ j \lt i $$) を $$ f(x) $$ とする. このとき, $$ g(i) = x $$ とすると,

$$
\min_{0 \leq y \lt x} f(y) \lt i-C_i
$$

となる最小の $$ x $$ が grundy 数となる. これは $$ f(x) $$ を最小値を求めるセグメントツリーに入れておき, 二分探索で求めることができる.
