---
title: "ARC #065 E"
problem: https://beta.atcoder.jp/contests/arc065/tasks/arc065_c
---
$$ D = d(a, b) $$ とすると, $$ a, b $$ から始めて幅優先探索で距離 $$ D $$ の点を探していき, 連結成分ができたらその辺の数が答えとなる.

愚直に計算すると $$ O(N^2) $$ かかるので, 距離 $$ D $$ の点を探すのを効率化する.

ある点 $$ (X, Y) $$ から距離 $$ D $$ の点であるが, これは以下の4つの集合の和集合である.

* $$ x+y=X+Y+D $$ 上にあり $$ X \leq x \leq X+D $$ を満たす
* $$ x-y=X-Y+D $$ 上にあり $$ X \leq x \leq X+D $$ を満たす
* $$ x+y=X+Y-D $$ 上にあり $$ X-D \leq x \leq X $$ を満たす
* $$ x-y=X-Y-D $$ 上にあり $$ X-D \leq x \leq X $$ を満たす

よって, すべての点を $$ x+y, x-y $$ で分類しておいてそれぞれ $$ x $$ 座標でソートして二分探索で求める.

ただし, この方法だと毎回見つかる点が多いと $$ O(N^2) $$ かかる.

そこで, 連結成分の頂点を見つけるフェーズと, 頂点がもつ辺の数を数えるフェーズに分ける.

連結成分の頂点を見つけるフェーズでは分類しておいたものを赤黒木に入れる. そして見つかった点は今後使わないので削除する.

頂点がもつ辺の数を数えるフェーズでは分類しておいたものを配列に入れてソートする. そして二分探索で個数を数える.
