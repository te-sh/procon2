---
title: "ARC #048 C"
problem: https://beta.atcoder.jp/contests/arc048/tasks/arc048_c
---
$$ L_i $$ は昇順にソートする.

1本目の足の配置は自由に決められる. 他の足についても先から $$ L_1 $$ 本を1本目と同じにすればいい. そうすると, 残りの $$ M_i = L_i - L_1 $$ 本は回文になるようにしなければならないことが分かる.

また, $$ i, j $$ ($$ i \lt j $$) 本目の足をつなげたものも回文にならないといけないので, $$ j $$ 本目の足の胴から $$ M_j-M_i $$ 本も回文にならなければならない. よって $$ M_N $$ を区間 $$ K_1 = (0, M_1], K_2 = (M_1, M_2], \dots, K_N = (M_{N-1}, M_N] $$ に分けたとき, 任意の連続する区間は回文にならなければならない.

ここで, $$ K_i, K_{i+1} $$ の区間ついてこれが成り立つ組み合わせ数を考える. $$ K_i \lt K_j $$ とする.

$$ K_i $$ の塗り方を決めると $$ K_{i+1} $$ の両端の塗り方が決まり, これにより $$ K_i $$ の端から $$ 2K_i $$ の区間が決まる. そうすると $$ K_{i+1} $$ の方も $$ 2K_i $$ の塗り方が決まり, 以下これを繰り返すと片方の端から進めていった場合もう片方の端に $$ K_{i+1} \bmod K_i $$ 個の余りができる.

この余りが $$ 0 $$ であれば期待どおりの回文ができている. そうでない場合は両端に余り部分があり, これがそれぞれ $$ K_i $$ の両端と一致しなければならないので, 余り部分も回文でなければならないことが分かる.

これを繰り返していくとユークリッドの互除法と同じ手順なので, 結局 $$ \gcd(K_i, K_{i+1}) $$ の長さの回文が集まったものにならなければならないことになる.

これがすべての $$ i, j $$ について成り立つには, $$ \gcd(K_1, K_2, \dots, K_N) $$ の長さの回文の集まりにしなければならない.

長さ $$ k $$ の回文の組み合わせは $$ 2^{\lceil k/2 \rceil} $$ であり, $$ L_1 $$ 部分は自由に決められるので, 答えは $$ 2^{\lceil k/2 \rceil + L_1} $$ となる.
