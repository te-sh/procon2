---
title: "ABC #128 F"
problem: https://atcoder.jp/contests/abc128/tasks/abc128_f
---
まず, $$ 0 \lt B \lt A \leq N-1 $$ である.

右に動いたときの座標は $$ A, A+(A-B), A+2(A-B), \dots $$ である.

右に動いたときに $$ N-1 $$ に到達しなければならない. そうでないと $$ N-1 $$ を超えてしまう. よって, $$ A-B $$ は $$ N-A-1 $$ の約数とならなければならない. これを考えると, $$ A $$ を決めたときの $$ B $$ の候補はかなり絞られることが分かる. よって, $$ A $$ は全探索し, $$ B $$ は上記の約数から求めてこれも全探索する.

次に左に動いたときの座標は $$ A-B, 2(A-B), 3(A-B), \dots $$ である. これが右に動いたときの座標と一致する要素があってはいけない. この条件を考える.

まず, 右に $$ k+1 $$ 回動いたときに $$ N-1 $$ に到達するとすると, $$ A+k(A-B) = N-1 $$ となるので, これを解いて,

$$
k = \frac{N-A-1}{A-B}
$$

となる.

また, 右に動いたときの座標と左に動いたときの座標で一致する要素がある必要条件は $$ A $$ が $$ A-B $$ の倍数のときである. よって, $$ A = m(A-B) $$ として, $$ A-B $$ を $$ C $$ とおいて考える.

右に動いたときの座標は $$ mC, (m+1)C, (m+2)C, \dots, (m+k)C $$ であり, 左に動いたときの座標は $$ C, 2C, 3C, \dots, kC $$ である. よって, $$ k \geq m $$ であれば右に動いたときの座標と左に動いたときの座標で一致する要素があることになる.

最後に右に動いたときの座標上の $$ s_i $$ の和と左に動いたときの座標上の $$ s_i $$ の和を考える.

右に動いたときの座標上の $$ s_i $$ の和は $$ N-1 $$ から $$ A-B $$ ごとに $$ k+1 $$ 個取得すればいい. 左に動いたときの座標上の $$ s_i $$ の和は $$ 0 $$ から $$ A-B $$ ごとに $$ k+1 $$ 個取得すればいい. よって, 右からと左からで $$ j $$ 個ごとの値の累積和をあらかじめ計算しておけば高速に計算できる.

$$ j $$ 個ごとの値の累積和は計算量が多くなりそうに見えるが, 調和級数の和は $$ O(logN) $$ になるので問題なく計算できる.
