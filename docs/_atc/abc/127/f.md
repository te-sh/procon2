---
title: "ABC #127 F"
problem: https://atcoder.jp/contests/abc127/tasks/abc127_f
---
$$ k $$ 個の更新クエリが与えられた結果

$$
f(x) = \vert x-a_1 \vert + \vert x-a_2 \vert + \cdots + \vert x-a_k \vert + b
$$

となっているとする. ($$ a_1 \leq a_2 \leq \cdots \leq a_k $$ とする)

このとき, $$ x \leq a_1 $$ では傾きは $$ -k $$ であり, $$ a_1 \leq x \leq a_2 $$ では傾きは $$ -k+2 $$ となる.

$$ k $$ が偶数ならば $$ a_{k/2} \leq x \leq a_{k/2+1} $$ で傾きが 0 となるので, $$ f(x) $$ が最小となる $$ x $$ の最小値は $$ a_{k/2} $$ である. このときの $$ f(x) $$ は,

$$
f(a_{k/2}) = -(a_1+a_2+ \cdots + a_{k/2}) + (a_{k/2+1}+a_{k/2+2}+ \cdots a_k)
$$

となる.

$$ k $$ が奇数ならば $$ x = a_{(k+1)/2} $$ で傾きが -1 から 1 に変わるので, $$ f(x) $$ が最小となる $$ x $$ は $$ a_{(k+1)/2} $$ である. このときの $$ f(x) $$ は

$$
f(a_{(k+1)/2}) = -(a_1+a_2+ \cdots + a_{(k+1)/2-1}) + (a_{(k+1)/2+1}+a_{(k+1)/2+2}+ \cdots + a_k)
$$

となる.

$$ a_i $$ を上位と下位に分けてそれぞれ最小値と最大値を返す優先順位付きキューで管理し, 更新クエリがあるたびにどちらかに追加しつつ上位と下位の数を調整していく. 上位と下位のそれぞれの和も同じように管理する.
